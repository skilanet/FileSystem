# Ядро файловой системы (FileSystemCore)

Центральный компонент, который объединяет все менеджеры и предоставляет высокоуровневый API для работы с файловой системой.

## Основные функции

### `format(volume_path, volume_size_mb)`
- Создает новый том и форматирует его
- Инициализирует все компоненты ФС: суперблок, битовую карту, FAT и корневой каталог

### `mount(volume_path)`
- Монтирует существующий том для работы
- Загружает метаданные и инициализирует все менеджеры

### `unmount()`
- Закрывает все открытые файлы и сбрасывает буферы
- Освобождает ресурсы и отключает том

## Операции с файлами

### `open_file(path, mode)`
- Открывает файл в указанном режиме:
    - `"r"` (чтение),
    - `"w"` (запись),
    - `"a"` (добавление),
    - `"r+"`, `"w+"`, `"a+"`
- Возвращает дескриптор файла для последующих операций

### `close_file(handle_id)`
- Закрывает файл по дескриптору
- Сбрасывает буферы и обновляет метаданные файла в каталоге

### `read_file(handle_id, buffer, bytes_to_read)`
- Читает данные из открытого файла в буфер
- Автоматически обрабатывает переходы между кластерами

### `write_file(handle_id, buffer, bytes_to_write)`
- Записывает данные в файл из буфера
- При необходимости автоматически выделяет новые кластеры

### `seek(handle_id, offset, whence)`
- Перемещает позицию чтения/записи в файле
- Поддерживает режимы:
    - `SEEK_SET` (от начала),
    - `SEEK_CUR` (от текущей позиции),
    - `SEEK_END` (от конца)

### `remove_file(path)`
- Удаляет файл и освобождает все его кластеры
- Обновляет битовую карту и FAT

### `rename_file(old_path, new_path)`
- Переименовывает файл или каталог
- Обновляет путь для открытых файлов

## Операции с каталогами

### `create_directory(path)`
- Создает новый каталог
- Выделяет кластер и инициализирует его как пустой каталог

### `remove_directory(path)`
- Удаляет пустой каталог
- Проверяет, что каталог не содержит файлов

### `list_directory(path)`
- Возвращает список всех записей в каталоге
- Для корневого каталога путь `"/"` или пустой

## Внутренние механизмы

### Буферизация
- Каждый открытый файл имеет буфер размером в один кластер
- Буфер автоматически сбрасывается при переходе к другому кластеру

### Управление дескрипторами
- Таблица открытых файлов хранит состояние каждого файла
- Автоматическая генерация уникальных дескрипторов

### Работа с кластерами
- `load_cluster_info_buffer` - загружает кластер в буфер файла
- `flush_cluster` - записывает буфер на диск
- `allocate_and_link_cluster` - выделяет новый кластер и добавляет в цепочку

## Режимы открытия файлов
- `"r"` - только чтение
- `"w"` - запись с удалением содержимого
- `"a"` - добавление в конец
- `"r+"` - чтение и запись
- `"w+"` - чтение и запись с удалением содержимого
- `"a+"` - чтение и добавление